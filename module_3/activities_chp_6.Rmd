---
title: "Exercise Worksheet (Chapter 6)"
author: "Dan Maxwell"
date: "June 1, 2017"
output:
  pdf_document: default
  html_document: default
header-includes: \usepackage{color}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load the datafile and supporting libraries...

```{r init}

library(sqldf)
library(dplyr)

```


### The Barplot Challenge

```{r barplot}

survey <- read.csv("informatics_survey.csv", stringsAsFactors = FALSE)

# What happens if we don't set the stringsAsFactors argument?
q <- data.frame(survey$Q5_1, stringsAsFactors = FALSE)

colnames(q) <- c("response")

# Remove the rows with empty responses.
q <- subset(q, response != "")
q <- q[q$response != "",]

cnts <- table(q)

# Save the original graph parameters.
opar <- par(no.readonly = TRUE)

# Adjust graph margin parameters.
par(mai = c(.5, 1.5, .5, .5))

# What does the las argument do?  Look it up with ?par().
barplot(cnts, 
        horiz = TRUE, 
        col   = 'lightblue',
        las   = 2,
        main  = "Knowledge of Statistics - Question 5.1",
        cex.names = 0.5)

par(opar)

```
Data Source: *2017 UF Informatics Survey*

## The Grouped & Stacked Barplot Challenge

```{r group_barplot}

crime <- read.csv("drink_crime.csv", stringsAsFactors = FALSE)

# Data must be presented as a matrix or vector for stacked or grouped barplots.

barplot(as.matrix(crime[, c(2:4)]), 
        legend = crime[, 1],
           col = c("red","blue","green","yellow"))

barplot(as.matrix(crime[, c(2:4)]), 
        legend = crime[, 1],
           col = c("red","blue","green","yellow"),
        beside = TRUE)

# Here's another way to create the barplots by creating a new dataframe.
lgnd        <- crime$Crime
binge       <- crime$Binge
occassional <- crime$Occasional
never       <- crime$Never
cnts        <- data.frame(binge, occassional, never)

barplot(as.matrix(cnts),
        legend = lgnd,
        col = c("red","blue","green","yellow"))

barplot(as.matrix(cnts),
        legend = lgnd,
        col = c("red","blue","green","yellow"),
        beside = TRUE )

```
Data Source: *Statistical Methods and Data Analysis* (p. 110)


## The Pie Chart Challenge

Code for the pie chart challenge:

```{r pie}
# You can write a select statement with new column names.
tmp <- sqldf("select q3 as department, count(q3) as total from survey where q3 != ' ' group by q3")

# Or, you can execute a simple select and rename the variables afterwards.
tmp <- sqldf("select q3, count(q3) from survey where q3 != ' ' group by q3")

# Rename the columns -- department & department count.
colnames(tmp)  <- c("dept","dept_cnt")

# Add new column for academic group (HUM Humanities, SCI Sciences, SOC, Social Sciences, MED Medical)
tmp$acad_grp <- ""                       

# Set the new acad_grp column, using fix().  What happens if you use edit()?
fix(tmp)                                   

# Save a backup copy of the modified dataframe.
write.csv(tmp, file = "tmp.csv")          

# Create a new dataframe of the two columns needed for the pie chart. 
temp   <- data.frame(tmp$acad_grp, tmp$dept_cnt, stringsAsFactors = FALSE)

colnames(temp) <- c("acad_grp","dept_cnt")

grp_by <- group_by(temp, acad_grp)                    # Group rows by academic group.

slices <- summarize(grp_by, grp_tot = sum(dept_cnt))  # Sum dept_cnt for each academic group.

# Assign descriptive labels to the slices.
slices$acad_grp[1] <- "Humanities"
slices$acad_grp[2] <- "Health Sciences"
slices$acad_grp[3] <- "Sciences"
slices$acad_grp[4] <- "Social Sciences"
slices$acad_grp[5] <- "Unknown"

pie(slices$grp_tot, labels = slices$acad_grp, main = "Pie Chart") 
# We can accomplish the same thing with the pipe operator.
slices <- group_by(temp, acad_grp) %>% summarize(grp_tot = sum(dept_cnt))

pie(slices$grp_tot, labels = slices$acad_grp, main = "Pie Chart (Pipe)") 
```
Data Source: *2017 UF Informatics Survey*


## The histogram challenge

Code for the histogram challenge:

```{r histogram}

opar <- par(no.readonly = TRUE)

par(mfrow = c(3, 1))

own <- read.delim("home_ownership.txt", sep = "\t", stringsAsFactors = FALSE)

hist(own$pct_1985, 
     main = "1985", 
     col  = "lightblue",
     ylim = c(0, 27),
     xlab = "Home Ownership %")

hist(own$pct_1996, 
     main = "1996", 
     col  = "lightblue",
     ylim = c(0, 27),
     xlab = "Home Ownership %")

hist(own$pct_2002, 
     main = "2002", 
     col  = "lightblue",
     ylim = c(0, 27),
     xlab = "Home Ownership %")

par(opar)

```
Data Source: *Statistical Methods and Data Analysis* (p. 129)

## The box plot challenge

Code for the box plot challenge:

```{r boxplot}

own <- read.delim("home_ownership.txt", sep = "\t", stringsAsFactors = FALSE)

boxplot(own$pct_1985, 
        own$pct_1996, 
        own$pct_2002, 
        notch = TRUE,
        ylab  = "Home Ownership %",
        main  = "Home Ownership in the United States",
        names = c("1985","1996","2002"))

```
Data Source: *Statistical Methods and Data Analysis* (p. 129)

## The scatter plot challenge

Code for the scatter plot challenge:

```{r scatterplot}

money <- read.delim("money_supply.txt", sep = "\t", stringsAsFactors = FALSE)

plot(money$m2, money$m3, xlab = "M2 (Trillions)", ylab = "M3 (Trillions)")

# Now, fit a regression model and plot the line.
fit <- lm(money$m3 ~ money$m2, data = money)

abline(fit, col = "blue")

```
Data Source: *Statistical Methods and Data Analysis* (p. 137)


## The stem-and-leaf Challenge

Code for the stem-and-leaf challenge:

```{r stemleaf}

ozone <- read.csv("ozone.csv", stringsAsFactors = FALSE)

x <- ozone[c(0:79),]

# The scale argument must equal 2 or the function only prints even numbers.
stem(x, scale = 2) 

```
Data Source: *Statistical Methods and Data Analysis* (p. 77)

