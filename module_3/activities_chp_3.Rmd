---
title: "Activities Worksheet (Chapter 3)"
author: "Dan Maxwell"
date: "June 1, 2017"
output:
  pdf_document: default
  html_document: default
header-includes: \usepackage{color}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load the supporting libraries...
 
```{r init}

library(sqldf)
library(dplyr)

```

## Introduction
Review the section notes for *R in Action* before working on the challenges.

> ### *Ref: R in Action (Section 3.3)* 
> Saving a baseline (parameters) to a variable is best practice.

> ### *Ref: R in Action (Section 3.4.6)* 
> Unfortunately, this section does not provide a lot of details about embedding
> mathematical symbols in your plots, other than point the reader to the plotmath
> demo. What is not stated in this section is that you'll need to use the
> `expression()` function to embed mathematical characters -- usually letters from
> the Greek alphabet -- into your graphs.  Let's take a look at how this is done: 

```{r, fig.width = 6.5, fig.height = 4.10}
# Create a blank plot.
plot(1:5, 1:5, type = "n")

# Add text inside the plot to demonstrate how to embed math symbols and/or equations.
text(2, 3, expression(mu))
text(3, 3, expression(sigma))
text(4, 3, expression(pi))
text(2, 2, expression(sqrt(x, y)))
text(3, 2, expression(frac(sum(x), n)))
text(4, 2, expression(x^2))

```
> The code listed here works fine if all you want to do is embed a formula.  But
> what if you also want to add explanatory text?  In that case, you'll need to use
> the `paste()` function.  Let's generate a simple histogram to show how this is
> done.

```{r}
# Generate random numbers from a normal distribution.
x <- rnorm(mean = 5, sd = 1, n = 50)

# Create a histogram with a title, indicating the mean and standard deviation.
hist(x, main = expression(paste("Sampled values, ", mu, " = 5, ", sigma, " = 1")),
         col = "lightblue")
```

> We now have a nice title for our graph with embedded symbols.  R provides
> support for just about any kind of mathematical expression.  To see more
> examples, type `?plotmath()` at the R prompt.

### The Basic Plot Challenge

```{r plot}

# Create dataframe from the data file
poverty <- read.delim("family_poverty.txt", sep = "\t", stringsAsFactors = FALSE)

opar <- par(no.readonly = TRUE)
ten  <- subset(poverty, year > 2005)

# Plot poverty % by year.
plot(ten$year, ten$family_poverty_pct,
               xlab = "Year",
               ylab = "Families in Poverty %",
               ylim = c(9, 13), 
               type = "b", 
               cex  = .75,
               lty  = 3,
               pch  = 1)

# Reset the parameters.
par() <- opar

```
Data Source: *U.S. Census Bureau*

This is a helpful sited for modifying the graph axes.

http://www.statmethods.net/advgraphs/axes.html

Plotting multiple lines.

```{r}

tmp <- read.delim("race_poverty.txt", sep = "\t", stringsAsFactors = FALSE)

# Because the read.delim command imports the tot_num_poverty variable as
# a character string, we need to convert it to a numeric.  The problem
# is that the "numbers" are formatted with commas.  These must first be
# removed before converting the string to a number.

tot_num_poverty <- as.numeric(gsub(",", "", tmp$tot_num_poverty))

# Remove na's at this point...
poverty <- data.frame(year = tmp$year, 
                      tot_num_poverty, 
                      pct_total_poverty = tmp$pct_total_poverty, 
                      race = tmp$race)

# Create vectors, one for each race represented.
white    <- subset(poverty, race == "white")
hispanic <- subset(poverty, race == "hispanic")
black    <- subset(poverty, race == "black")
asian    <- subset(poverty, race == "asian")

# Check the new vectors.  Do they have na's in them?  If so, we have 
# to deal with them.  This is defensive programming.
is.na(white$year)
is.na(white$tot_num_poverty)

x <- white$year
y <- white$tot_num_poverty

plot(x, y,
     xlab = "Year",
     ylab = "Total Number in Poverty (1000's)",
     ylim = c(7000, 20000),
     type = "b", 
     cex  = .75,
     lty  = 3,
     col  = "blue",
     pch  = 1,
     las  = 1,
     cex.axis = .60)

x <- hispanic$year
y <- hispanic$tot_num_poverty

# Now plot the Hispanic line, using a different color and line type.
lines(x, y, type = "b", lty = 2, col = "red", pch = 0, cex = .75)

# Add legend to distinguish between the two lines.
legend("bottomright",
       title = "Race",
       c("White","Hispanic"),
       lty   = c(3, 2), 
       pch   = c(1, 0),
       col   = c("blue","red"))

```
Data Source: *U.S. Census Bureau*


## The Histogram Challenge

The histogram challenge...

```{r energy_histogram}

# Create dataframe from data file.
energy <- read.csv("energy_expend.csv", stringsAsFactors = FALSE)

# Two ways to create separate vectors for each stature factor.
lst <- split(energy$expend, energy$stature)

lean  <- energy$expend[energy$stature == "lean"]
obese <- energy$expend[energy$stature == "obese"]

# Set graphic device parameters to 2 rows and 1 column.
par(mfrow = c(2, 1))    

# Graph the two vectors.
hist(lean, breaks = 10, xlim = c(5, 13), ylim = c(0, 4), col = "lightblue")
hist(obese, breaks = 10, xlim = c(5, 13), ylim = c(0, 4), col = "lemonchiffon")

# Restore graphic device to 1 row, 1 column.
par(mfrow = c(1, 1))    

```

Now, let's create a boxplot of the data...


```{r energy_boxplot}

# Two ways to create the boxplot.
boxplot(lean, obese, names = c("Lean","Obese"))
boxplot(energy$expend ~ energy$stature, names = c("Lean","Obese"))

```


And finally, let's create a stripchart.

```{r}
opar <- par(no.readonly = TRUE)
par(mfrow = c(2,2), mex = 0.8, mar = c(3, 3, 2, 1) + .1)

stripchart(energy$expend ~ energy$stature)
stripchart(energy$expend ~ energy$stature, method = "stack")
stripchart(energy$expend ~ energy$stature, method = "jitter")
stripchart(energy$expend ~ energy$stature, method = "jitter", jitter = .03)

par() <- opar

```
Data Source: *Introductory Statistics with R* (p. 79 - 83)


Dalgaard, P. (2008). *Introductory statistics with R* (2nd ed.). New York: Springer.

Census Bureau: https://www.census.gov/data/tables/time-series/demo/income-poverty/historical-poverty-people.html




